# Minimal Neo4j Enterprise cluster example
# This creates a cluster with minimum topology: 1 primary + 1 secondary
# Uses unified clustering approach with RAFT enabled for full cluster capabilities

apiVersion: neo4j.neo4j.com/v1alpha1
kind: Neo4jEnterpriseCluster
metadata:
  name: minimal-cluster
  namespace: default
spec:
  # Neo4j Enterprise Edition (required for this operator)
  edition: enterprise

  # Neo4j Docker image configuration
  image:
    repo: neo4j
    tag: "5.26-enterprise"  # Neo4j 5.26+ required
    pullPolicy: IfNotPresent

  # Minimal cluster topology: 1 primary + 1 secondary (minimum required)
  # Uses unified clustering approach with V2_ONLY discovery for 5.26+
  topology:
    primaries: 1      # Single primary with clustering enabled
    secondaries: 1    # One read replica for minimum cluster topology

  # Storage configuration
  storage:
    className: standard  # Use your cluster's default storage class
    size: "10Gi"        # Adjust based on your data needs

  # Resource allocation
  resources:
    requests:
      memory: "2Gi"     # Initial memory allocation
      cpu: "500m"       # Initial CPU allocation
    limits:
      memory: "4Gi"     # Maximum memory
      cpu: "2"          # Maximum CPU cores

  # TLS disabled for simplicity (enable for production)
  tls:
    mode: disabled

  # Required environment variables
  env:
    - name: NEO4J_ACCEPT_LICENSE_AGREEMENT
      value: "yes"      # Required for Neo4j Enterprise

---
# Admin credentials secret (create this before applying the cluster)
# kubectl create secret generic neo4j-admin-secret \
#   --from-literal=username=neo4j \
#   --from-literal=password=your-secure-password
#
# NOTE: For single-node deployments without clustering, use Neo4jEnterpriseStandalone instead.
# See examples/standalone/single-node-standalone.yaml for non-clustered deployments.
